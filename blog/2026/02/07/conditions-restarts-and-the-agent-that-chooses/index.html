<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>

  <script async src="https://www.googletagmanager.com/gtag/js?id=G-JTFD2R6QYL"></script>
  <script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-JTFD2R6QYL');
</script>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  
  <meta name="viewport" content="width=device-width,minimum-scale=1,maximum-scale=1">

  
    
    
      <link href="https://quasilabs.in/blog/css/fonts.css" rel="stylesheet" type="text/css">
    
  

  
  <title>Conditions, Restarts, and the Agent That Chooses</title>

  
  
  <link rel="stylesheet" href="https://quasilabs.in/blog/css/hugo-octopress.css">

  
  
    <link rel="stylesheet" href="https://quasilabs.in/blog/css/custom.css">
  

  
    <link rel="stylesheet" href="https://quasilabs.in/blog/css/fork-awesome.min.css">
  

  
  
    <link href="https://quasilabs.in/blog/favicon.png" rel="icon">
  

  
  

  <meta name="description" content="" />
  <meta name="keywords" content="">
  <meta name="author" content="quasiLabs">

  
  <meta name="generator" content="Hugo 0.155.1">

  
  

  
  



</head>
<body>


<header role="banner">
<hgroup>
  
  <h1><a href="https://quasilabs.in/blog/">quasiLabs Blog</a></h1>
    <h2>Stories from the code-mines</h2>
</hgroup> </header>


<nav role="navigation">
<fieldset class="mobile-nav">
  
  <select onchange="location = this.value;">
    <option value="">Navigate…</option>
      
        
          <option value="https://quasilabs.in/blog/">» Posts</option>
        
      
        
          <option value="https://quasilabs.in/blog/categories/">» Categories</option>
        
      
        
          <option value="https://quasilabs.in/blog/tags/">» Tags</option>
        
      
  </select>
</fieldset>


<ul class="main-navigation">
  
  <li><a href="https://quasilabs.in/" title="Home">Home</a></li>
  
    
      <li><a href="https://quasilabs.in/blog/" title="Posts">Posts</a></li>
    
  
    
      <li><a href="https://quasilabs.in/blog/categories/" title="Categories"  rel="noopener noreferrer">Categories</a></li>
    
  
    
      <li><a href="https://quasilabs.in/blog/tags/" title="Tags"  rel="noopener noreferrer">Tags</a></li>
    
  
</ul>

<ul class="subscription">
  
</ul>

 </nav> 


<div id="main">
  <div id="content">
    <div>
      <article class="hentry" role="article">

        
        

<header>
  <p class="meta">Feb 7, 2026
     - 8 minute read 
    

    
    
      - <a class="label" href="https://quasilabs.in/blog/categories/software-architecture/">Software Architecture </a>
    
  </p>
  <h1 class="entry-title">
     Conditions, Restarts, and the Agent That Chooses 
  </h1>
</header> 

        <div class="entry-content">
          
          
          
          <p><em>A companion to my friend Chaitanya Gupta&rsquo;s excellent 
<a href="https://lisper.in/restarts" target="_blank" rel="noopener">Common Lisp: A Tutorial on Conditions and Restarts</a></em></p>
<hr>
<p>Common Lisp&rsquo;s condition system separates <strong>signalling</strong> an error from <strong>handling</strong> it. The code that detects a problem does not decide what to do about it. It establishes <strong>restarts</strong> — named recovery options — and signals a condition. A handler higher up the call stack selects a restart.</p>
<p>Restarts can be selected interactively from the debugger or programmatically via <code>handler-bind</code> and <code>invoke-restart</code>. The original tutorial demonstrates both: a human selecting restarts from the debugger menu, and <code>list-csv-errors</code> selecting them in code. The programmatic path works, but it operates on restart names and error message strings. The handler must know, at compile time, which restart to pick for which situation. It cannot reason about the system&rsquo;s goals, weigh tradeoffs between recovery options, or adapt its strategy to context it was not explicitly programmed for.</p>
<p>This limitation is invisible when the handler is a <code>handler-bind</code> form written by the same programmer who wrote the restarts. It becomes a problem when the handler is an LLM-based agent.</p>
<h2 id="but-what-if-the-handler-is-an-agent">But what if the handler is an agent?</h2>
<p>An agent monitoring a data pipeline encounters a validation error at 3 AM. It sees:</p>
<pre tabindex="0"><code>ERROR:
  message: &#34;URL invalid.&#34;
  value:   &#34;not-a-url&#34;

AVAILABLE RESTARTS:
  CONTINUE-NEXT-FIELD  — &#34;Continue validation on next field.&#34;
  CONTINUE-NEXT-ROW    — &#34;Continue validation on next row.&#34;
  RETRY-FILE           — &#34;Retry validating the file /data/input.csv.&#34;
</code></pre><p>Three recovery options. No context for choosing between them. The agent does not know:</p>
<ul>
<li><strong>What the system is trying to achieve.</strong> Is data integrity the priority, or is completing the full pass more important?</li>
<li><strong>What failed and why.</strong> Is this a format error or a structural problem? Does it affect one cell or the entire row?</li>
<li><strong>Why these specific restarts exist.</strong> What design rationale led to offering field-level, row-level, and file-level recovery?</li>
<li><strong>What each choice costs.</strong> Does skipping this field violate a system goal?</li>
</ul>
<p>The condition system provides the <em>mechanism</em> for recovery. What the agent lacks is the <em>semantic context</em> for making an informed choice.</p>
<p>Now consider what the agent sees when the same system is built with structured intent metadata:</p>
<pre tabindex="0"><code>ERROR:
  message: &#34;URL invalid.&#34;
  value:   &#34;not-a-url&#34;
  line:    3

GOALS:
  :DATA-INTEGRITY        — &#34;Every field value conforms to its header&#39;s
                            type and format rules&#34;
  :GRACEFUL-RECOVERY     — &#34;Validation failures are recoverable at field,
                            row, and file granularity&#34;
  :PROGRAMMATIC-COLLECTION — &#34;Callers can collect all errors without
                              entering the debugger&#34;

AVAILABLE RESTARTS:
  CONTINUE-NEXT-FIELD  — &#34;Continue validation on next field.&#34;
  CONTINUE-NEXT-ROW    — &#34;Continue validation on next row.&#34;
  RETRY-FILE           — &#34;Retry validating the file /data/input.csv.&#34;

DESIGN RATIONALE:
  chose: &#34;Three-level restart hierarchy: field, row, file&#34;
  over:  (&#34;Single abort-all restart&#34; &#34;Per-field restarts only&#34;)
  because: &#34;Field-level lets callers skip bad cells while validating
            remaining fields. Row-level lets callers skip structurally
            malformed rows. File-level lets callers fix the source and
            retry. Each level enables a different recovery strategy
            without dictating which one to use.&#34;
</code></pre><p>Same restarts. Profoundly different decision-making surface. The agent can now map recovery options to system goals, understand the designer&rsquo;s rationale, and select a strategy that serves the right objective.</p>
<p>The remainder of this article shows how to produce that second view.</p>
<h2 id="intent-makes-restarts-agent-legible">Intent makes restarts agent-legible</h2>
<p>
<a href="https://github.com/quasilabs/telos" target="_blank" rel="noopener">Telos</a> is a Common Lisp library for intent introspection. It captures the <em>why</em> behind code — purpose, goals, failure modes, design decisions — and makes it queryable at runtime. Combined with conditions and restarts, it produces <strong>machine-readable recovery context</strong>.</p>
<p>The following sections rebuild the CSV validator from 
<a href="https://lisper.in/restarts" target="_blank" rel="noopener">the original tutorial</a> with telos. The validation logic and restart architecture are unchanged. What changes is the metadata layer.</p>
<h3 id="the-feature-hierarchy">The feature hierarchy</h3>
<p>Before writing any functions, declare what the system is for:</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-lisp" data-lang="lisp"><span style="display:flex;"><span><span style="color:#111">(</span><span style="color:#111">deffeature</span> <span style="color:#111">csv-validation</span>
</span></span><span style="display:flex;"><span>  <span style="color:#d88200">:purpose</span> <span style="color:#d88200">&#34;Validate CSV files against header-defined field schemas
</span></span></span><span style="display:flex;"><span><span style="color:#d88200">            with recoverable error handling&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#d88200">:goals</span> <span style="color:#111">((</span><span style="color:#d88200">:data-integrity</span>
</span></span><span style="display:flex;"><span>            <span style="color:#d88200">&#34;Every field value conforms to its header&#39;s type and format rules&#34;</span><span style="color:#111">)</span>
</span></span><span style="display:flex;"><span>          <span style="color:#111">(</span><span style="color:#d88200">:graceful-recovery</span>
</span></span><span style="display:flex;"><span>            <span style="color:#d88200">&#34;Validation failures are recoverable at field, row,
</span></span></span><span style="display:flex;"><span><span style="color:#d88200">             and file granularity&#34;</span><span style="color:#111">)</span>
</span></span><span style="display:flex;"><span>          <span style="color:#111">(</span><span style="color:#d88200">:programmatic-collection</span>
</span></span><span style="display:flex;"><span>            <span style="color:#d88200">&#34;Callers can collect all errors without entering the debugger&#34;</span><span style="color:#111">))</span>
</span></span><span style="display:flex;"><span>  <span style="color:#d88200">:decisions</span> <span style="color:#111">((</span><span style="color:#d88200">:id</span> <span style="color:#d88200">:layered-restarts</span>
</span></span><span style="display:flex;"><span>               <span style="color:#d88200">:chose</span> <span style="color:#d88200">&#34;Three-level restart hierarchy: field, row, file&#34;</span>
</span></span><span style="display:flex;"><span>               <span style="color:#d88200">:over</span> <span style="color:#111">(</span><span style="color:#d88200">&#34;Single abort-all restart&#34;</span>
</span></span><span style="display:flex;"><span>                      <span style="color:#d88200">&#34;Per-field restarts only&#34;</span><span style="color:#111">)</span>
</span></span><span style="display:flex;"><span>               <span style="color:#d88200">:because</span> <span style="color:#d88200">&#34;Field-level lets callers skip bad cells while
</span></span></span><span style="display:flex;"><span><span style="color:#d88200">                         validating remaining fields. Row-level lets callers
</span></span></span><span style="display:flex;"><span><span style="color:#d88200">                         skip structurally malformed rows. File-level lets
</span></span></span><span style="display:flex;"><span><span style="color:#d88200">                         callers fix the source and retry. Each level enables
</span></span></span><span style="display:flex;"><span><span style="color:#d88200">                         a different recovery strategy without dictating
</span></span></span><span style="display:flex;"><span><span style="color:#d88200">                         which one to use.&#34;</span><span style="color:#111">)))</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#111">(</span><span style="color:#111">deffeature</span> <span style="color:#111">field-validation</span>
</span></span><span style="display:flex;"><span>  <span style="color:#d88200">:purpose</span> <span style="color:#d88200">&#34;Validate individual CSV field values against
</span></span></span><span style="display:flex;"><span><span style="color:#d88200">            header-specific format rules&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#d88200">:belongs-to</span> <span style="color:#111">csv-validation</span>
</span></span><span style="display:flex;"><span>  <span style="color:#d88200">:goals</span> <span style="color:#111">((</span><span style="color:#d88200">:field-correct</span>
</span></span><span style="display:flex;"><span>            <span style="color:#d88200">&#34;Each field value satisfies its header&#39;s validation predicate&#34;</span><span style="color:#111">))</span>
</span></span><span style="display:flex;"><span>  <span style="color:#d88200">:failure-modes</span> <span style="color:#111">((</span><span style="color:#d88200">:unknown-header</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#d88200">&#34;Header name has no associated validation rule&#34;</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#d88200">:violates</span> <span style="color:#d88200">:data-integrity</span><span style="color:#111">)</span>
</span></span><span style="display:flex;"><span>                  <span style="color:#111">(</span><span style="color:#d88200">:format-mismatch</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#d88200">&#34;Field value does not match expected format&#34;</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#d88200">:violates</span> <span style="color:#d88200">:field-correct</span><span style="color:#111">)))</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#111">(</span><span style="color:#111">deffeature</span> <span style="color:#111">error-recovery</span>
</span></span><span style="display:flex;"><span>  <span style="color:#d88200">:purpose</span> <span style="color:#d88200">&#34;Provide structured restart points for non-local recovery
</span></span></span><span style="display:flex;"><span><span style="color:#d88200">            from validation errors&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#d88200">:belongs-to</span> <span style="color:#111">csv-validation</span>
</span></span><span style="display:flex;"><span>  <span style="color:#d88200">:goals</span> <span style="color:#111">((</span><span style="color:#d88200">:restart-availability</span>
</span></span><span style="display:flex;"><span>            <span style="color:#d88200">&#34;Every validation error has at least one applicable restart&#34;</span><span style="color:#111">)</span>
</span></span><span style="display:flex;"><span>          <span style="color:#111">(</span><span style="color:#d88200">:caller-autonomy</span>
</span></span><span style="display:flex;"><span>            <span style="color:#d88200">&#34;The handler--human or agent--chooses recovery strategy,
</span></span></span><span style="display:flex;"><span><span style="color:#d88200">             not the validator&#34;</span><span style="color:#111">)))</span>
</span></span></code></pre></div><p>Three properties worth noting:</p>
<ol>
<li><strong>Goals are named.</strong> <code>:data-integrity</code>, <code>:graceful-recovery</code>, <code>:programmatic-collection</code>. An agent references these by ID, not by parsing English.</li>
<li><strong>Failure modes link to goals.</strong> <code>:format-mismatch</code> violates <code>:field-correct</code>. The agent knows which objective breaks when this error occurs.</li>
<li><strong>Design decisions are recorded.</strong> The layered restart strategy was chosen over alternatives, for stated reasons. An agent can read this rationale before selecting a restart.</li>
</ol>
<h3 id="the-condition-with-intent">The condition with intent</h3>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-lisp" data-lang="lisp"><span style="display:flex;"><span><span style="color:#111">(</span><span style="color:#111">define-condition/i</span> <span style="color:#111">csv-error</span> <span style="color:#111">(</span><span style="color:#00a8c8">error</span><span style="color:#111">)</span>
</span></span><span style="display:flex;"><span>  <span style="color:#111">((</span><span style="color:#111">message</span> <span style="color:#f92672">...</span><span style="color:#111">)</span>
</span></span><span style="display:flex;"><span>   <span style="color:#111">(</span><span style="color:#111">value</span> <span style="color:#f92672">...</span><span style="color:#111">)</span>
</span></span><span style="display:flex;"><span>   <span style="color:#111">(</span><span style="color:#111">line-number</span> <span style="color:#f92672">...</span><span style="color:#111">))</span>
</span></span><span style="display:flex;"><span>  <span style="color:#111">(</span><span style="color:#d88200">:feature</span> <span style="color:#111">csv-validation</span><span style="color:#111">)</span>
</span></span><span style="display:flex;"><span>  <span style="color:#111">(</span><span style="color:#d88200">:role</span> <span style="color:#d88200">&#34;Unified signal type for all validation failures,
</span></span></span><span style="display:flex;"><span><span style="color:#d88200">          carrying enough context for recovery decisions&#34;</span><span style="color:#111">)</span>
</span></span><span style="display:flex;"><span>  <span style="color:#111">(</span><span style="color:#d88200">:purpose</span> <span style="color:#d88200">&#34;Bridge between low-level validation checks
</span></span></span><span style="display:flex;"><span><span style="color:#d88200">             and high-level recovery handlers&#34;</span><span style="color:#111">))</span>
</span></span></code></pre></div><p>The condition now carries declared intent. An agent encountering a <code>csv-error</code> can query telos for its purpose, its parent feature, and that feature&rsquo;s goals.</p>
<h3 id="validators-with-failure-modes">Validators with failure modes</h3>
<p>Each validator declares what can go wrong:</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-lisp" data-lang="lisp"><span style="display:flex;"><span><span style="color:#111">(</span><span style="color:#111">defun/i</span> <span style="color:#111">validate-url</span> <span style="color:#111">(</span><span style="color:#75af00">string</span><span style="color:#111">)</span>
</span></span><span style="display:flex;"><span>  <span style="color:#d88200">&#34;The URL of the page; should start with http:// or https://.&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#111">(</span><span style="color:#d88200">:feature</span> <span style="color:#111">field-validation</span><span style="color:#111">)</span>
</span></span><span style="display:flex;"><span>  <span style="color:#111">(</span><span style="color:#d88200">:role</span> <span style="color:#d88200">&#34;Enforce URL protocol prefix requirement&#34;</span><span style="color:#111">)</span>
</span></span><span style="display:flex;"><span>  <span style="color:#111">(</span><span style="color:#d88200">:failure-modes</span> <span style="color:#111">((</span><span style="color:#d88200">:no-protocol</span>
</span></span><span style="display:flex;"><span>                     <span style="color:#d88200">&#34;URL missing http:// or https:// prefix&#34;</span>
</span></span><span style="display:flex;"><span>                     <span style="color:#d88200">:violates</span> <span style="color:#d88200">:field-correct</span><span style="color:#111">)))</span>
</span></span><span style="display:flex;"><span>  <span style="color:#111">(</span><span style="color:#111">unless</span> <span style="color:#111">(</span><span style="color:#111">cl-ppcre:scan</span> <span style="color:#d88200">&#34;^https?://&#34;</span> <span style="color:#75af00">string</span><span style="color:#111">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#111">(</span><span style="color:#111">csv-error</span> <span style="color:#d88200">&#34;URL invalid.&#34;</span> <span style="color:#d88200">:value</span> <span style="color:#75af00">string</span><span style="color:#111">)))</span>
</span></span></code></pre></div><p>The validation logic is identical to the original. The addition is metadata: this function belongs to <code>field-validation</code>, plays a specific role, and its failure mode (<code>:no-protocol</code>) violates a specific goal (<code>:field-correct</code>).</p>
<p>The validator and restart code is unchanged from the original tutorial — <code>validate-csv</code> establishes <code>retry-file</code>, <code>continue-next-row</code>, and <code>continue-next-field</code> restarts exactly as before. The full working code is in 
<a href="../examples/csv-validator.lisp">examples/csv-validator.lisp</a>.</p>
<h2 id="building-recovery-context">Building recovery context</h2>
<p>The function that assembles the structured view shown earlier:</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-lisp" data-lang="lisp"><span style="display:flex;"><span><span style="color:#111">(</span><span style="color:#111">defun/i</span> <span style="color:#111">build-recovery-context</span> <span style="color:#111">(</span><span style="color:#00a8c8">condition</span><span style="color:#111">)</span>
</span></span><span style="display:flex;"><span>  <span style="color:#d88200">&#34;Build structured context an LLM agent needs to choose a restart.&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#111">(</span><span style="color:#d88200">:feature</span> <span style="color:#111">agent-recovery</span><span style="color:#111">)</span>
</span></span><span style="display:flex;"><span>  <span style="color:#111">(</span><span style="color:#d88200">:role</span> <span style="color:#d88200">&#34;Transform runtime condition + telos metadata into
</span></span></span><span style="display:flex;"><span><span style="color:#d88200">          agent-legible recovery context&#34;</span><span style="color:#111">)</span>
</span></span><span style="display:flex;"><span>  <span style="color:#111">(</span><span style="color:#00a8c8">let*</span> <span style="color:#111">((</span><span style="color:#111">restarts</span> <span style="color:#111">(</span><span style="color:#75af00">compute-restarts</span> <span style="color:#00a8c8">condition</span><span style="color:#111">))</span>
</span></span><span style="display:flex;"><span>         <span style="color:#111">(</span><span style="color:#111">feature-intent</span> <span style="color:#111">(</span><span style="color:#111">feature-intent</span> <span style="color:#d88200">&#39;csv-validation</span><span style="color:#111">))</span>
</span></span><span style="display:flex;"><span>         <span style="color:#111">(</span><span style="color:#111">goals</span> <span style="color:#111">(</span><span style="color:#111">intent-goals</span> <span style="color:#111">feature-intent</span><span style="color:#111">))</span>
</span></span><span style="display:flex;"><span>         <span style="color:#111">(</span><span style="color:#111">decisions</span> <span style="color:#111">(</span><span style="color:#111">list-decisions</span> <span style="color:#d88200">&#39;csv-validation</span><span style="color:#111">)))</span>
</span></span><span style="display:flex;"><span>    <span style="color:#111">(</span><span style="color:#75af00">list</span>
</span></span><span style="display:flex;"><span>     <span style="color:#d88200">:error</span> <span style="color:#111">(</span><span style="color:#75af00">list</span> <span style="color:#d88200">:message</span> <span style="color:#111">(</span><span style="color:#111">csv-error-message</span> <span style="color:#00a8c8">condition</span><span style="color:#111">)</span>
</span></span><span style="display:flex;"><span>                  <span style="color:#d88200">:value</span> <span style="color:#111">(</span><span style="color:#111">csv-error-value</span> <span style="color:#00a8c8">condition</span><span style="color:#111">)</span>
</span></span><span style="display:flex;"><span>                  <span style="color:#d88200">:line</span> <span style="color:#111">(</span><span style="color:#111">csv-error-line-number</span> <span style="color:#00a8c8">condition</span><span style="color:#111">))</span>
</span></span><span style="display:flex;"><span>     <span style="color:#d88200">:goals</span> <span style="color:#111">goals</span>
</span></span><span style="display:flex;"><span>     <span style="color:#d88200">:available-restarts</span>
</span></span><span style="display:flex;"><span>     <span style="color:#111">(</span><span style="color:#111">loop</span> <span style="color:#111">for</span> <span style="color:#111">r</span> <span style="color:#111">in</span> <span style="color:#111">restarts</span>
</span></span><span style="display:flex;"><span>           <span style="color:#111">for</span> <span style="color:#111">name</span> <span style="color:#75af00">=</span> <span style="color:#111">(</span><span style="color:#75af00">restart-name</span> <span style="color:#111">r</span><span style="color:#111">)</span>
</span></span><span style="display:flex;"><span>           <span style="color:#111">when</span> <span style="color:#111">(</span><span style="color:#75af00">member</span> <span style="color:#111">name</span> <span style="color:#f92672">&#39;</span><span style="color:#111">(</span><span style="color:#111">continue-next-field</span>
</span></span><span style="display:flex;"><span>                               <span style="color:#111">continue-next-row</span>
</span></span><span style="display:flex;"><span>                               <span style="color:#111">retry-file</span><span style="color:#111">))</span>
</span></span><span style="display:flex;"><span>           <span style="color:#111">collect</span> <span style="color:#111">(</span><span style="color:#75af00">list</span> <span style="color:#d88200">:name</span> <span style="color:#111">name</span>
</span></span><span style="display:flex;"><span>                         <span style="color:#d88200">:description</span> <span style="color:#111">(</span><span style="color:#75af00">princ-to-string</span> <span style="color:#111">r</span><span style="color:#111">)))</span>
</span></span><span style="display:flex;"><span>     <span style="color:#d88200">:design-rationale</span>
</span></span><span style="display:flex;"><span>     <span style="color:#111">(</span><span style="color:#75af00">mapcar</span> <span style="color:#111">(</span><span style="color:#111">lambda</span> <span style="color:#111">(</span><span style="color:#111">d</span><span style="color:#111">)</span>
</span></span><span style="display:flex;"><span>               <span style="color:#111">(</span><span style="color:#75af00">list</span> <span style="color:#d88200">:chose</span> <span style="color:#111">(</span><span style="color:#111">decision-chose</span> <span style="color:#111">d</span><span style="color:#111">)</span>
</span></span><span style="display:flex;"><span>                     <span style="color:#d88200">:over</span> <span style="color:#111">(</span><span style="color:#111">decision-over</span> <span style="color:#111">d</span><span style="color:#111">)</span>
</span></span><span style="display:flex;"><span>                     <span style="color:#d88200">:because</span> <span style="color:#111">(</span><span style="color:#111">decision-because</span> <span style="color:#111">d</span><span style="color:#111">)))</span>
</span></span><span style="display:flex;"><span>             <span style="color:#111">decisions</span><span style="color:#111">))))</span>
</span></span></code></pre></div><p>This function combines three sources: the runtime condition (what happened), <code>compute-restarts</code> (what recovery options exist), and telos queries (why things are the way they are). The result is the structured plist shown in the agent&rsquo;s view above.</p>
<h2 id="agent-as-handler">Agent as handler</h2>
<p>With structured context, the agent can implement recovery strategies mapped to system goals:</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-lisp" data-lang="lisp"><span style="display:flex;"><span><span style="color:#111">(</span><span style="color:#111">defun/i</span> <span style="color:#111">agent-handle-csv-error</span> <span style="color:#111">(</span><span style="color:#00a8c8">condition</span> <span style="color:#00a8c8">&amp;key</span> <span style="color:#111">(</span><span style="color:#111">strategy</span> <span style="color:#d88200">:collect-all</span><span style="color:#111">))</span>
</span></span><span style="display:flex;"><span>  <span style="color:#d88200">&#34;Agent-style handler that chooses restarts based on
</span></span></span><span style="display:flex;"><span><span style="color:#d88200">   structured intent context.&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#111">(</span><span style="color:#d88200">:feature</span> <span style="color:#111">agent-recovery</span><span style="color:#111">)</span>
</span></span><span style="display:flex;"><span>  <span style="color:#111">(</span><span style="color:#d88200">:role</span> <span style="color:#d88200">&#34;Choose restarts based on structured intent context&#34;</span><span style="color:#111">)</span>
</span></span><span style="display:flex;"><span>  <span style="color:#111">(</span><span style="color:#111">ecase</span> <span style="color:#111">strategy</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">;; Audit mode: skip individual fields, keep validating everything.</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">;; Serves goal :PROGRAMMATIC-COLLECTION.</span>
</span></span><span style="display:flex;"><span>    <span style="color:#111">(</span><span style="color:#d88200">:collect-all</span>
</span></span><span style="display:flex;"><span>     <span style="color:#111">(</span><span style="color:#00a8c8">let</span> <span style="color:#111">((</span><span style="color:#75af00">restart</span> <span style="color:#111">(</span><span style="color:#75af00">find-restart</span> <span style="color:#d88200">&#39;continue-next-field</span><span style="color:#111">)))</span>
</span></span><span style="display:flex;"><span>       <span style="color:#111">(</span><span style="color:#111">when</span> <span style="color:#75af00">restart</span> <span style="color:#111">(</span><span style="color:#75af00">invoke-restart</span> <span style="color:#75af00">restart</span><span style="color:#111">))))</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">;; Pipeline mode: one bad field taints the whole row.</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">;; Serves goal :DATA-INTEGRITY (strict interpretation).</span>
</span></span><span style="display:flex;"><span>    <span style="color:#111">(</span><span style="color:#d88200">:strict-rows</span>
</span></span><span style="display:flex;"><span>     <span style="color:#111">(</span><span style="color:#00a8c8">let</span> <span style="color:#111">((</span><span style="color:#75af00">restart</span> <span style="color:#111">(</span><span style="color:#75af00">find-restart</span> <span style="color:#d88200">&#39;continue-next-row</span><span style="color:#111">)))</span>
</span></span><span style="display:flex;"><span>       <span style="color:#111">(</span><span style="color:#111">when</span> <span style="color:#75af00">restart</span> <span style="color:#111">(</span><span style="color:#75af00">invoke-restart</span> <span style="color:#75af00">restart</span><span style="color:#111">))))</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">;; Interactive mode: log problems for agent reasoning.</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">;; Serves goal :GRACEFUL-RECOVERY.</span>
</span></span><span style="display:flex;"><span>    <span style="color:#111">(</span><span style="color:#d88200">:fix-and-retry</span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">...</span><span style="color:#111">)))</span>
</span></span></code></pre></div><p>Each strategy is a different interpretation of the system&rsquo;s goals:</p>
<table>
  <thead>
      <tr>
          <th>Goal</th>
          <th>Strategy</th>
          <th>Restart chosen</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>:programmatic-collection</code></td>
          <td><code>:collect-all</code></td>
          <td><code>continue-next-field</code></td>
      </tr>
      <tr>
          <td><code>:data-integrity</code></td>
          <td><code>:strict-rows</code></td>
          <td><code>continue-next-row</code></td>
      </tr>
      <tr>
          <td><code>:graceful-recovery</code></td>
          <td><code>:fix-and-retry</code></td>
          <td><code>continue-next-field</code> (after logging)</td>
      </tr>
  </tbody>
</table>
<p>In strict-rows mode, the agent sees one error per bad row instead of four:</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-lisp" data-lang="lisp"><span style="display:flex;"><span><span style="color:#111">(</span><span style="color:#00a8c8">let</span> <span style="color:#111">((</span><span style="color:#111">errors</span> <span style="color:#00a8c8">nil</span><span style="color:#111">))</span>
</span></span><span style="display:flex;"><span>  <span style="color:#111">(</span><span style="color:#111">handler-bind</span>
</span></span><span style="display:flex;"><span>      <span style="color:#111">((</span><span style="color:#111">csv-error</span> <span style="color:#111">(</span><span style="color:#111">lambda</span> <span style="color:#111">(</span><span style="color:#111">c</span><span style="color:#111">)</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#111">(</span><span style="color:#111">push</span> <span style="color:#111">c</span> <span style="color:#111">errors</span><span style="color:#111">)</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#111">(</span><span style="color:#111">agent-handle-csv-error</span> <span style="color:#111">c</span> <span style="color:#d88200">:strategy</span> <span style="color:#d88200">:strict-rows</span><span style="color:#111">))))</span>
</span></span><span style="display:flex;"><span>    <span style="color:#111">(</span><span style="color:#111">validate-csv</span> <span style="color:#d88200">&#34;/tmp/test.csv&#34;</span><span style="color:#111">))</span>
</span></span><span style="display:flex;"><span>  <span style="color:#111">(</span><span style="color:#75af00">length</span> <span style="color:#111">errors</span><span style="color:#111">))</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">;; =&gt; 1  (vs. 4 in audit mode)</span>
</span></span></code></pre></div><p>The row had four invalid fields. In audit mode the agent records all four. In strict-rows mode it records the first and discards the row. Same validator, same restarts — different handler strategy, informed by declared goals.</p>
<p>In a production system, the strategy itself need not be static. An LLM agent with access to <code>build-recovery-context</code> can reason over goals and rationale at runtime, selecting or combining strategies based on the operational context: audit during batch imports, strict during pipeline runs, interactive when a human is available for escalation.</p>
<h2 id="the-broader-implication">The broader implication</h2>
<p>Common Lisp&rsquo;s condition system embodies a principle that predates the current generation of AI by three decades: <strong>the code that detects a problem should not decide how to recover from it.</strong> That decision belongs to whoever has the broader context.</p>
<p>The condition/restart protocol already provides the right architecture for agentic error recovery. It separates mechanism from policy. It supports multiple simultaneous recovery options without the signaller knowing which will be chosen. It allows the handler to be arbitrarily far — in code, in time, in understanding — from the signaller.</p>
<p>What it lacks is structured context for the handler. Programmatic handlers work when the programmer hardcodes the right restart for each case. Agent handlers need more: they need to understand the system&rsquo;s objectives, the failure taxonomy, and the designer&rsquo;s rationale for the recovery architecture.</p>
<p>Telos provides this. It does not replace conditions and restarts — it makes them <strong>agent-legible</strong>.</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-lisp" data-lang="lisp"><span style="display:flex;"><span><span style="color:#111">(</span><span style="color:#111">intent-chain</span> <span style="color:#d88200">&#39;validate-url</span><span style="color:#111">)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">;; =&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">;; FUNCTION validate-url</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">;;   role: &#34;Enforce URL protocol prefix requirement&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">;;   failure-modes: ((:NO-PROTOCOL ...))</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">;; FEATURE field-validation</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">;;   purpose: &#34;Validate individual CSV field values...&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">;; FEATURE csv-validation</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">;;   purpose: &#34;Validate CSV files against header-defined</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">;;             field schemas with recoverable error handling&#34;</span>
</span></span></code></pre></div><p>One query. The agent traces from a specific function through the feature hierarchy to the system&rsquo;s purpose. It knows what failed, what feature the failure belongs to, and what the system is trying to achieve. That is the context required to choose a restart intelligently.</p>
<p>The condition system gave us the right abstraction 35 years ago. <em><strong>Agents</strong></em> are the handlers it was waiting for.</p>
<hr>
<p><em>Full working code: 
<a href="https://github.com/quasi/telos/blob/main/examples/csv-validator.lisp" target="_blank" rel="noopener">examples/csv-validator.lisp</a></em></p>
<p><em>
<a href="https://github.com/quasi/telos" target="_blank" rel="noopener">Telos</a> — intent introspection for Common Lisp</em></p>

        </div>
        

<footer>
  <p class="meta">
    <span class="byline author vcard">Posted by <span class="fn">quasiLabs</span></span>
    
    <time>Feb 7, 2026</time>
    
      <span class="categories">
        Tags:
        
          <a class="category" href="https://quasilabs.in/blog/tags/common-lisp">Common Lisp</a>  <a class="category" href="https://quasilabs.in/blog/tags/agent-architecture">Agent Architecture</a>  <a class="category" href="https://quasilabs.in/blog/tags/error-handling">Error Handling</a>  <a class="category" href="https://quasilabs.in/blog/tags/telos">Telos</a>  
    
    </span>
  </p>

  

  <p class="meta">
    
        <a class="basic-alignment left" href="https://quasilabs.in/blog/2026/02/02/building-an-agent-council/" title="Building an Agent Council">Building an Agent Council</a>
    

    
  </p>
  
</footer> 
      </article>
    </div>
    

<aside class="sidebar thirds">
  <section class="first odd">

    

    <p>
      
    </p>
  </section>

  
  



<ul class="sidebar-nav">
  <li class="sidebar-nav-item">
    
    
    
    
    
    
    
    
    
    
    
    

  
  
  </li>
</ul>

  

  

  
  
  
</aside>

  </div>
</div>

    <footer role="contentinfo">
      <p><a href="https://quasilabs.in/blog/">quasiLabs</a>
       &copy; 2010 - 2026 
      </p>
    </footer>

    
    



    
    
    

    
  </body>
</html>

